<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In recent years, there have been more systems to distribute data at global scale, especially so given the rise of the NewSQL systems like Google Spanner 1, CockroachDB and Microsoft Cosmos DB. While providing the same scalable performance of NoSQL systems, they still maintain strong consistency guarantees by relying upon some forms of wide area network (WAN) coordination service. Among them, ZooKeeper 2 is the most popular coordination service used in many projects in Facebook and Apache."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="WanKeeper: Efficient Distributed Coordination at WAN-scale"><meta property="og:description" content="In recent years, there have been more systems to distribute data at global scale, especially so given the rise of the NewSQL systems like Google Spanner 1, CockroachDB and Microsoft Cosmos DB. While providing the same scalable performance of NoSQL systems, they still maintain strong consistency guarantees by relying upon some forms of wide area network (WAN) coordination service. Among them, ZooKeeper 2 is the most popular coordination service used in many projects in Facebook and Apache."><meta property="og:type" content="article"><meta property="og:url" content="/docs/wankeeper/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2017-06-17T00:00:00+00:00"><meta property="article:modified_time" content="2017-06-17T00:00:00+00:00"><title>WanKeeper: Efficient Distributed Coordination at WAN-scale | Principia</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.a82d7e77ceb134d151c4d7e381eeb30623fbd5a524d58c584d8716ecec0205bd.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.3ea095379c68544c8867a35ba6c951296928d8ffa5abecc75c8355e601653b1c.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Principia</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Docs</span><ul><li><a href=/docs/abd/>ABD Algorithm</a></li><li><a href=/docs/model-checker/>Model Checker in Go</a></li><li><a href=/docs/topology-mapping/>Topology Mapping Algorithm</a></li><li><a href=/docs/neural-network/>Neural Network</a></li><li><a href=/docs/transaction/>Distributed Transactions</a></li><li><a href=/docs/wankeeper/ class=active>WanKeeper: Efficient Distributed Coordination at WAN-scale</a></li><li><a href=/docs/paxos_reconfiguration/>Paxos Reconfiguration</a></li><li><a href=/docs/sonification/>What Paxos sounds like</a></li><li><a href=/docs/tla+/>TLA+ wiki</a></li></ul></li></ul><ul><li><a href=https://github.com/ailidani target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>WanKeeper: Efficient Distributed Coordination at WAN-scale</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><p>In recent years, there have been more systems to distribute data at global scale, especially so given the rise of the <a href=https://en.wikipedia.org/wiki/NewSQL>NewSQL</a> systems like <a href=https://cloud.google.com/spanner/>Google Spanner</a> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, <a href=https://www.cockroachlabs.com/>CockroachDB</a> and <a href=https://azure.microsoft.com/en-us/services/cosmos-db/>Microsoft Cosmos DB</a>. While providing the same scalable performance of NoSQL systems, they still maintain strong consistency guarantees by relying upon some forms of wide area network (WAN) coordination service. Among them, <a href=http://zookeeper.apache.org/>ZooKeeper</a> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> is the most popular coordination service used in many projects in Facebook and Apache.</p><div style=text-align:center><img src=zk_table.png alt=centra style=width:600px></div><p>ZooKeeper implements the Zab <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> protocol that, similar to Multi-Paxos <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> and Raft <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, relies on the stable leader $\lambda$ to serialize the total order of events. Every replica in the system only communicates with $\lambda$ unless there&rsquo;s leader failure. We call this type of systems <strong>centralized</strong> coordination. A centralized coordination cannot be used in WAN because its performance limitations, specifically, it fails to scale with respect to increasing distance from a replica to stable leader. Each operation will suffer from WAN latency.</p><div style=text-align:center><img src=centralized.jpg alt=centra style=width:250px>
<img src=leaderless.jpg alt=decentra style=width:250px></div><p>Other protocols, like Generalized Paxos <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup> and EPaxos <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>, opportunistically allow <strong>decentralized</strong> coordination by depending on a fast quorum to detect any conflicts before the value is committed. The fast quorum size is much larger than a simple quorum, therefore, it fails to scale with respect to increasing number of nodes in a globally deployed system.</p><p>One simple solution to scale ZooKeeper to multiple sites is running separate ZooKeeper cluster in each site, then maintain consistency between clusters using external method like 2 phase commit (2PC) or <em>sync</em> operations. Such solution has two major drawbacks: (1) data in each cluster is statically partitioned, therefore performance is limited by the operations targeting nonlocal data; and (2) any inter-site coordination (e.g. 2PC) is complicated and does not scale with more sites.</p><p>WanKeeper provides a novel hybrid framework that extends centralized coordination by using hierarchical composition and token migration ideas. WanKeeper architecture is simple by design. We designate one cluster as the higher level (L2) cluster, preferably in the geographical center of the global system. L2-cluster&rsquo;s task is to serialize conflicting requests from any cluster and serve tokens to the suitable cluster while ensuring freedom from deadlocks and starvation. A token for each object in the system represents the exclusive ownership of that object. If tokens for all the objects needed for an operation are present at the cluster, the operation is executed at that cluster without involving communication to L2 for coordination. If an operation involves items for which tokens are not present in this cluster, the leader forwards the operation-request to L2.</p><p>We argue that the hierarchical architecture is more scalable because it reduces the communication complexity and exploits the locality exhibited in the workload.</p><div style=text-align:center><img src=wankeeper.png alt=wankeeper style=width:600px></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Corbett, James C., et al. &ldquo;Spanner: Googleâ€™s globally distributed database.&rdquo; <em>ACM Transactions on Computer Systems (TOCS)</em> 31.3 (2013): 8.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Hunt, Patrick, et al. &ldquo;ZooKeeper: Wait-free Coordination for Internet-scale Systems.&rdquo; <em>USENIX annual technical conference.</em> Vol. 8. 2010.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Junqueira, Flavio P., Benjamin C. Reed, and Marco Serafini. &ldquo;Zab: High-performance broadcast for primary-backup systems.&rdquo; <em>Dependable Systems & Networks (DSN), 2011 IEEE/IFIP 41st International Conference on.</em> IEEE, 2011.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Van Renesse, Robbert, and Deniz Altinbuken. &ldquo;Paxos made moderately complex.&rdquo; <em>ACM Computing Surveys (CSUR)</em> 47.3 (2015): 42.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Ongaro, Diego, and John K. Ousterhout. &ldquo;In Search of an Understandable Consensus Algorithm.&rdquo; <em>USENIX Annual Technical Conference.</em> 2014.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Lamport, Leslie. &ldquo;Generalized consensus and Paxos.&rdquo; <em>Technical Report MSR-TR-2005-33,</em> Microsoft Research, 2005.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>Moraru, Iulian, David G. Andersen, and Michael Kaminsky. &ldquo;There is more consensus in egalitarian parliaments.&rdquo; <em>Proceedings of the Twenty-Fourth ACM Symposium on Operating Systems Principles.</em> ACM, 2013.&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script>
<script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></body></html>